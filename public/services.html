<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <title>Yacht Provisioning Ibiza | Drinks & Food Delivery</title>  
        <meta name="description" content="Premier yacht provisioning service in Ibiza. Delivering gourmet food, drinks, and supplies directly to your yacht. Fast, reliable, and tailored to your needs."> 
        <link rel="shortcut icon" href="/assets/img/favicon-16x16.png">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Barlow&family=Barlow+Condensed&family=Gilda+Display&display=swap">
        <link rel="stylesheet" href="/assets/css/plugins.css">
        <link rel="stylesheet" href="/assets/css/style.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
        <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
        <script src="https://js.stripe.com/v3/"></script>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Barlow:wght@400;500;600;700&family=Gilda+Display&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
        <meta http-equiv="Content-Security-Policy" content="font-src 'self' https://fonts.gstatic.com https://*.firebaseapp.com https://*.googleapis.com https://cdnjs.cloudflare.com data:;">
        <style>
          

          /* WhatsApp Button */
          .elegant-whatsapp {
              position: fixed;
              bottom: 40px;
              right: 40px;
              z-index: 99;
              text-decoration: none;
              transition: all 0.3s ease;
          }

          .elegant-whatsapp-inner {
              display: flex;
              align-items: center;
              padding: 12px 20px;
              background-color: rgba(32, 149, 174, 0.9);
              color: white;
              border-radius: 30px;
              box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
              transition: all 0.3s ease;
          }

          .elegant-whatsapp-inner i {
              font-size: 22px;
              margin-right: 8px;
          }

          .elegant-whatsapp-text {
              font-family: 'Barlow Condensed', sans-serif;
              font-size: 14px;
              letter-spacing: 1px;
              text-transform: uppercase;
          }

          .elegant-whatsapp:hover .elegant-whatsapp-inner {
              background-color: rgba(32, 149, 174, 1);
              transform: translateY(-5px);
              box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
          }

          /* Mobile adjustments */
          @media screen and (max-width: 767px) {
              .elegant-whatsapp {
                  bottom: 90px; /* Adjust to not overlap with mobile cart toggle */
                  right: 20px;
              }
              
              .elegant-whatsapp-inner {
                  padding: 10px 16px;
              }
              
              .elegant-whatsapp-text {
                  display: none;
              }
              
              .elegant-whatsapp-inner i {
                  margin-right: 0;
                  font-size: 24px;
              }
          }

          /* Fixed Product Card Styling */
          .product-card {
              background-color: #ffffff; /* White background */
              border: 1px solid #e0e0e0; /* Light grey border */
              border-radius: 12px;
              overflow: hidden;
              transition: all 0.3s ease;
              height: 100%;
              display: flex;
              flex-direction: column;
              box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05); /* Soft shadow */
          }

          .product-card:hover {
              transform: translateY(-4px);
              border-color: rgba(32, 149, 174, 0.6);
              box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
          }

         .product-image-container {
    position: relative;
    height: 250px; /* Increased height to show more of the bottle */
    overflow: hidden;
    background-color: #f8f9fa; /* Light background for better presentation */
    display: flex;
    align-items: center;
    justify-content: center;
}

.product-image {
    width: 100%;
    height: 100%;
    object-fit: contain; /* Changed from 'cover' to 'contain' */
    transition: transform 0.3s ease;
    padding: 10px; /* Add some padding around the image */
}

.product-card:hover .product-image {
    transform: scale(1.05);
}

          /* UPDATED: Hide the price overlay */
          .product-overlay {
              display: none;
          }

          .product-content {
              padding: 20px;
              flex-grow: 1;
              display: flex;
              flex-direction: column;
          }

          .product-name {
              font-family: 'Gilda Display', serif;
              font-size: 18px;
              color: #333; /* Darker text for readability */
              margin-bottom: 5px; /* Reduced margin for price */
              line-height: 1.3;
          }

          /* NEW: Prominent price styling in content area */
          .product-price {
              font-family: 'Gilda Display', serif;
              font-size: 24px;
              color: #2095AE;
              font-weight: 600;
              margin-bottom: 12px;
              display: block;
              line-height: 1;
          }

          .product-description {
              font-family: 'Barlow', sans-serif;
              font-size: 14px;
              color: #666; /* Medium grey for description */
              margin-bottom: 15px;
              line-height: 1.4;
              display: -webkit-box;
              -webkit-line-clamp: 2; /* Added for compatibility */
              -webkit-box-orient: vertical;
              overflow: hidden;
          }

          .product-actions {
              margin-top: auto;
              display: flex;
              align-items: center;
              justify-content: space-between;
              gap: 15px;
              padding-top: 15px;
              border-top: 1px solid #e0e0e0; /* Light border */
          }

          .quantity-controls {
              display: flex;
              align-items: center;
              background: #f0f0f0; /* Light background */
              border: 1px solid #ddd; /* Light border */
              border-radius: 6px;
          }

          .qty-btn {
              background: transparent;
              border: none;
              color: #555; /* Darker color for buttons */
              width: 32px;
              height: 32px;
              display: flex;
              align-items: center;
              justify-content: center;
              cursor: pointer;
              transition: all 0.2s ease;
          }

          .qty-btn:hover {
              background: rgba(32, 149, 174, 0.1); /* Lighter hover effect */
              color: #2095AE;
          }

          .quantity-display {
              min-width: 35px;
              text-align: center;
              font-family: 'Barlow', sans-serif;
              font-size: 14px;
              color: #333; /* Darker text */
              font-weight: 600;
          }

          .add-to-cart-btn {
              background: linear-gradient(135deg, #2095AE 0%, #1a7a8a 100%);
              border: none;
              color: white;
              padding: 8px 16px;
              border-radius: 6px;
              font-family: 'Barlow Condensed', sans-serif;
              font-size: 12px;
              font-weight: 600;
              text-transform: uppercase;
              letter-spacing: 1px;
              cursor: pointer;
              transition: all 0.3s ease;
              display: flex;
              align-items: center;
              gap: 6px;
          }

          .add-to-cart-btn:hover {
              transform: translateY(-1px);
              box-shadow: 0 4px 12px rgba(32, 149, 174, 0.4);
          }

          /* Contents preview for platters */
          .contents-preview {
              margin-bottom: 15px;
          }

          .contents-title {
              font-family: 'Barlow Condensed', sans-serif;
              font-size: 12px;
              color: #2095AE;
              text-transform: uppercase;
              letter-spacing: 1px;
              margin-bottom: 8px;
              font-weight: 600;
          }

          .contents-list {
              display: flex;
              flex-wrap: wrap;
              gap: 4px;
          }

          .content-tag {
              background: rgba(32, 149, 174, 0.1); /* Lighter background for tags */
              color: #2095AE; /* Teal text for tags */
              padding: 2px 8px;
              border-radius: 12px;
              font-size: 11px;
              font-family: 'Barlow', sans-serif;
          }

          /* Loading state */
          .loading-spinner {
              display: flex;
              justify-content: center;
              align-items: center;
              height: 200px;
              color: #2095AE;
          }

          .spinner {
              width: 40px;
              height: 40px;
              border: 4px solid rgba(32, 149, 174, 0.3);
              border-left-color: #2095AE;
              border-radius: 50%;
              animation: spin 1s linear infinite;
          }

          @keyframes spin {
              to { transform: rotate(360deg); }
          }

          /* Fixed Order Summary */
          .order-summary {
              position: fixed;
              bottom: 20px;
              right: 20px;
              z-index: 1000;
              display: none; /* Controlled by JS */
              background-color: #ffffff; /* White background */
              border: 1px solid #e0e0e0; /* Light border */
              border-radius: 12px;
              padding: 20px;
              min-width: 300px;
              max-width: 350px;
              box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); /* Lighter shadow */
              transition: transform 0.3s ease-out, opacity 0.3s ease-out; /* For mobile slide-up */
          }

          .summary-header {
              display: flex;
              justify-content: flex-start; /* Align items to the start */
              align-items: center;
              margin-bottom: 15px;
              padding-bottom: 10px;
              border-bottom: 1px solid #eee;
              /* Add padding-right to make space for the absolute close button */
              padding-right: 100px; /* Adjust as needed for the close button width */
          }

          .summary-header h3 {
              font-family: 'Gilda Display', serif;
              font-size: 18px;
              color: #333; /* Darker text */
              margin: 0; /* Remove default margin */
              margin-right: 10px; /* Space between title and item count */
          }

          .item-count {
              font-family: 'Barlow Condensed', sans-serif;
              font-size: 13px; /* Slightly smaller for better readability next to title */
              color: #555; /* Slightly darker for better contrast */
              text-transform: uppercase;
              letter-spacing: 1px;
              margin: 0; /* Ensure no conflicting margins */
          }
          /* Remove any potential CSS-added 'x' from item-count */
          .item-count::after {
              content: none !important;
          }

          .summary-items {
              max-height: 200px;
              overflow-y: auto;
              margin-bottom: 15px;
          }

          .summary-item {
              display: flex;
              justify-content: space-between;
              align-items: center;
              padding: 8px 0;
              border-bottom: 1px solid #f5f5f5; /* Very light border */
          }

          .summary-item:last-child {
              border-bottom: none;
          }

          .item-info {
              flex-grow: 1;
          }

          .item-name {
              font-family: 'Barlow', sans-serif;
              font-size: 14px;
              color: #333; /* Darker text */
              display: block;
          }

          .item-details {
              font-family: 'Barlow', sans-serif;
              font-size: 12px;
              color: #777; /* Medium grey */
              display: block;
          }

          .item-total {
              font-family: 'Barlow', sans-serif;
              font-size: 14px;
              color: #2095AE;
              font-weight: 600;
              margin-left: 10px;
          }

          /* New styles for cart quantity controls */
          .quantity-controls-cart {
              display: flex;
              align-items: center;
              background: #f0f0f0;
              border: 1px solid #ddd;
              border-radius: 6px;
              margin-left: 10px; /* Space from item info */
          }

          .qty-btn-cart {
              background: transparent;
              border: none;
              color: #555;
              width: 28px; /* Slightly smaller buttons for cart */
              height: 28px;
              display: flex;
              align-items: center;
              justify-content: center;
              cursor: pointer;
              transition: all 0.2s ease;
          }

          .qty-btn-cart:hover {
              background: rgba(32, 149, 174, 0.1);
              color: #2095AE;
          }

          .quantity-display-cart {
              min-width: 25px; /* Adjust width */
              text-align: center;
              font-family: 'Barlow', sans-serif;
              font-size: 13px; /* Slightly smaller font */
              color: #333;
              font-weight: 600;
          }

          .summary-total {
              display: flex;
              justify-content: space-between;
              align-items: center;
              padding: 15px 0;
              border-top: 2px solid #e0e0e0; /* Light border */
              margin-bottom: 15px;
          }

          .total-label {
              font-family: 'Gilda Display', serif;
              font-size: 18px;
              color: #333; /* Darker text */
              font-weight: 400;
          }

          .total-amount {
              font-family: 'Gilda Display', serif;
              font-size: 24px;
              color: #2095AE;
              font-weight: 400;
          }

          .btn-checkout {
              width: 100%;
              background: linear-gradient(135deg, #2095AE 0%, #1a7a8a 100%);
              border: none;
              color: white;
              padding: 12px;
              border-radius: 8px;
              font-family: 'Barlow Condensed', sans-serif;
              font-size: 14px;
              font-weight: 600;
              text-transform: uppercase;
              letter-spacing: 2px;
              cursor: pointer;
              transition: all 0.3s ease;
          }

          .btn-checkout:hover:not(:disabled) {
              transform: translateY(-2px);
              box-shadow: 0 8px 20px rgba(32, 149, 174, 0.4);
          }

          .btn-checkout:disabled {
              opacity: 0.5;
              cursor: not-allowed;
          }

          /* Mobile Cart Toggle Button */
          .mobile-cart-toggle {
              position: fixed;
              bottom: 20px;
              left: 50%;
              transform: translateX(-50%);
              background: linear-gradient(135deg, #2095AE 0%, #1a7a8a 100%);
              color: white;
              padding: 12px 25px;
              border-radius: 30px;
              border: none;
              font-family: 'Barlow Condensed', sans-serif;
              font-size: 16px;
              letter-spacing: 1px;
              text-transform: uppercase;
              z-index: 1001; /* Above order summary */
              box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
              display: none; /* Hidden by default, shown by JS on mobile when cart has items */
              cursor: pointer;
              transition: transform 0.2s ease, box-shadow 0.2s ease;
          }

          .mobile-cart-toggle:hover {
              transform: translateX(-50%) translateY(-2px);
              box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
          }

          .mobile-cart-toggle i {
              margin-right: 8px;
          }

          /* Mobile-specific styles for order summary */
          @media (max-width: 768px) {
              .order-summary {
                  position: fixed;
                  bottom: 0;
                  left: 0;
                  right: 0;
                  border-radius: 12px 12px 0 0;
                  max-width: none;
                  min-width: auto;
                  transform: translateY(100%); /* Start off-screen */
                  opacity: 0;
                  visibility: hidden;
                  transition: transform 0.3s ease-out, opacity 0.3s ease-out, visibility 0s linear 0.3s;
              }

              .order-summary.show-mobile {
                  transform: translateY(0);
                  opacity: 1;
                  visibility: visible;
                  transition: transform 0.3s ease-out, opacity 0.3s ease-out;
              }

              .order-summary .close-btn-mobile {
                  display: block; /* Show close button on mobile */
                  position: absolute;
                  top: 10px;
                  right: 15px; /* Adjusted right position to prevent overlap */
                  background: none;
                  border: none;
                  font-size: 24px;
                  color: #777; /* Ensure visible color */
                  cursor: pointer;
                  z-index: 1002;
                  display: flex; /* Use flex to align icon and text */
                  align-items: center;
                  padding: 0; /* Ensure no extra padding pushes it */
              }
              .order-summary .close-btn-mobile .close-cart-text {
                  font-size: 14px;
                  margin-left: 5px;
                  vertical-align: middle;
                  color: #777; /* Match button icon color */
              }

              /* Ensure desktop order summary is hidden when mobile toggle is active */
              .order-summary.desktop-hidden {
                  display: none !important;
              }

              /* Hide desktop order summary when mobile cart toggle is visible */
              .order-summary {
                  display: none;
              }
          }

          /* Desktop-specific styles for order summary */
          @media (min-width: 769px) {
              .order-summary {
                  display: block; /* Always show on desktop when cart has items */
              }
              .mobile-cart-toggle {
                  display: none !important; /* Hide mobile toggle on desktop */
              }
              .order-summary .close-btn-mobile {
                  display: none; /* Hide close button on desktop */
              }
          }

          /* Adjust section background */
          .categories.bg-darkblack {
              background-color: #f0f2f5; /* Light grey background for the section */
          }

          /* Adjust navigation pills */
          .nav-pills .nav-link {
              background-color: #e9ecef; /* Light grey pill background */
              color: #333; /* Dark text */
              border-radius: 8px;
              transition: all 0.3s ease;
          }

          .nav-pills .nav-link.active,
          .nav-pills .nav-link:hover {
              background-color: #2095AE; /* Teal active/hover */
              color: white;
          }

          /* Adjust filter section elements */
          .filters-section .form-control,
          .filters-section .form-select {
              background-color: #ffffff; /* White background */
              border: 1px solid #ddd; /* Light border */
              color: #333;
          }

          .filters-section .form-control::placeholder {
              color: #999;
          }

          .filters-section .search-icon {
              color: #777;
          }

          .offcanvas-header {
              background-color: #ffffff;
              border-bottom: 1px solid #eee;
          }
          .offcanvas-title {
              color: #333;
          }
          .offcanvas-body {
              background-color: #f8f8f8;
          }
          .filter-label {
              color: #555;
          }
          .btn-filter {
              background-color: #e9ecef;
              color: #333; /* Ensure text is visible */
              border: 1px solid #ddd;
              border-radius: 8px; /* Added for consistency */
          }
          .btn-filter:hover {
              background-color: #dee2e6;
          }
          .btn-secondary {
              background-color: #6c757d;
              border-color: #6c757d;
              color: white;
              border-radius: 8px; /* Added for consistency */
          }
          .btn-primary {
              background-color: #2095AE;
              border-color: #2095AE;
              color: white;
              border-radius: 8px; /* Added for consistency */
          }

          /* Specific style for offcanvas close button */
          .offcanvas-header .btn-close {
              color: #555; /* Darker color for visibility */
              opacity: 1; /* Ensure it's not faded */
          }
          .offcanvas-header .btn-close:hover {
              color: #333; /* Darker on hover */
              opacity: 0.8;
          }

          /* Checkout Modal adjustments for light theme */
          .modal-content {
              background-color: #ffffff;
              color: #333;
              border-radius: 12px;
          }
          .modal-header {
              border-bottom-color: #eee;
              padding: 15px 20px;
          }
          .modal-title {
              color: #333;
              font-family: 'Gilda Display', serif;
              font-size: 22px;
          }
          .modal-body {
              padding: 20px;
          }
          .modal-body label {
              color: #555;
              font-weight: 500;
              margin-bottom: 5px;
              display: block;
          }
          .modal-body .form-control, .modal-body .form-select {
              background-color: #f8f8f8;
              border: 1px solid #ddd;
              color: #333;
              border-radius: 8px;
              padding: 10px 15px;
              margin-bottom: 15px; /* Added spacing */
          }
          .modal-body .form-control:focus, .modal-body .form-select:focus {
              border-color: #2095AE;
              box-shadow: 0 0 0 0.25rem rgba(32, 149, 174, 0.25);
          }
          .modal-body .alert-info {
              background-color: #e0f7fa;
              border-color: #b2ebf2;
              color: #00796b;
              border-radius: 8px;
              padding: 10px;
          }
          .modal-body .form-check-label {
              color: #555;
          }
          .modal-footer {
              border-top-color: #eee;
              padding: 15px 20px;
              justify-content: space-between; /* Space out buttons */
          }
          .list-group-item {
              background-color: #ffffff;
              border-color: #eee;
              color: #333;
              padding: 10px 0;
          }
          .list-group-item .item-name {
              font-weight: 600;
          }
          .list-group-item .text-muted {
              color: #777 !important;
          }
          .modal-body h5 {
              font-family: 'Gilda Display', serif;
              font-size: 20px;
              color: #333;
              margin-top: 20px;
              padding-top: 15px;
              border-top: 1px dashed #eee; /* Subtle separator */
          }
          .modal-body #checkoutTotal {
              color: #2095AE;
              font-size: 26px;
              font-weight: 700;
          }

          /* New CSS for Add to Cart feedback */
          .add-to-cart-feedback {
              font-family: 'Barlow Condensed', sans-serif;
              font-size: 12px;
              color: #28a745; /* Green color */
              margin-left: 10px;
              opacity: 1;
              transition: opacity 0.5s ease-out;
          }
          .add-to-cart-feedback.fade-out {
              opacity: 0;
          }

          /* Ensure modal close buttons are visible */
          .modal-header .btn-close {
            color: #555; /* Darker color for visibility */
            opacity: 1; /* Ensure it's not faded */
          }
          .modal-header .btn-close:hover {
            color: #333; /* Darker on hover */
            opacity: 0.8;
          }
          /* Pagination Styles */
.pagination-container {
    margin-top: 40px;
}

.pagination {
    gap: 8px;
}

.pagination .page-item .page-link {
    border: 2px solid #e0e0e0;
    color: #333;
    background-color: #ffffff;
    padding: 12px 16px;
    border-radius: 8px;
    font-family: 'Barlow', sans-serif;
    font-weight: 600;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 48px;
    min-height: 48px;
}

.pagination .page-item .page-link:hover {
    border-color: #2095AE;
    background-color: rgba(32, 149, 174, 0.1);
    color: #2095AE;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(32, 149, 174, 0.2);
}

.pagination .page-item.active .page-link {
    background: linear-gradient(135deg, #2095AE 0%, #1a7a8a 100%);
    border-color: #2095AE;
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(32, 149, 174, 0.4);
}

.pagination .page-item.disabled .page-link {
    background-color: #f8f9fa;
    border-color: #e9ecef;
    color: #6c757d;
    cursor: not-allowed;
}

.pagination .page-item.disabled .page-link:hover {
    background-color: #f8f9fa;
    border-color: #e9ecef;
    color: #6c757d;
    transform: none;
    box-shadow: none;
}

.pagination .page-item .page-link i {
    font-size: 14px;
}

/* Results counter styling */
.pagination-container .text-muted {
    font-family: 'Barlow', sans-serif;
    font-size: 14px;
    color: #666 !important;
}

/* Mobile pagination adjustments */
@media (max-width: 768px) {
    .pagination {
        gap: 4px;
    }
    
    .pagination .page-item .page-link {
        padding: 10px 12px;
        min-width: 40px;
        min-height: 40px;
        font-size: 14px;
    }
    
    /* Hide page numbers on very small screens, keep only prev/next */
    @media (max-width: 480px) {
        .pagination .page-item:not(:first-child):not(:last-child):not(.active) {
            display: none;
        }
        
        .pagination .page-item.active {
            order: 1;
        }
        
        .pagination .page-item:first-child {
            order: 0;
        }
        
        .pagination .page-item:last-child {
            order: 2;
        }
    }
}
        </style>
    </head>
<body>
    
    <div class="progress-wrap cursor-pointer">
        <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
            <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98" />
        </svg>
    </div>
    
    <nav class="navbar navbar-expand-lg">
        <div class="container">
          <div class="logo-wrapper">
            <a class="logo" href="index.html">
              <h2>Just Enjoy Ibiza <span>Boats</span></h2>
            </a>
          </div>
          <button class="custom-toggler" type="button" aria-label="Toggle navigation">
            <span class="toggler-icon">
              <span class="line"></span>
              <span class="line"></span>
              <span class="line"></span>
            </span>
          </button>
          <div class="collapse navbar-collapse" id="navbar">
            <ul class="navbar-nav ms-auto align-items-center">
              <li class="nav-item">
                <a class="nav-link" href="about.html">ABOUT US</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="yacht-rental.html">OUR BOATS</a>
              </li>
              <li class="nav-item dropdown" id="servicesDropdown">
                <a class="nav-link dropdown-toggle" href="#" id="servicesDropdownToggle" role="button">
                  SERVICES
                </a>
                <ul class="dropdown-menu">
                  <li>
                    <a class="dropdown-item" href="yacht-rental.html">BOAT RENTAL</a>
                  </li>
                  <li>
                    <a class="dropdown-item" href="services.html">CATERING DELIVERY</a>
                  </li>
                </ul>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="contact.html">CONTACT</a>
              </li>
            </ul>
          </div>
        </div>
    </nav>
    
    <div class="banner-header section-padding valign bg-img bg-fixed" data-overlay-dark="4" data-background="/assets/img/YachtDelivery.JPG">
        <div class="container">
            <div class="row">
                <div class="col-md-12 text-left caption mt-90">
                    <h5>Enhance Your Experience</h5>
                    <h1>Ibiza Boat Catering | Food & Beverage Delivery Service</h1>
                </div>
            </div>
        </div>
    </div>
   
    <section class="categories section-padding bg-darkblack">
        <div class="container">
            
            <ul class="nav nav-pills justify-content-center mb-5" id="cateringTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="drinks-tab" data-bs-toggle="pill" data-bs-target="#drinks" type="button" role="tab" aria-controls="drinks" aria-selected="true" data-category="drinks">
                        <i class="fas fa-glass-martini-alt"></i> Drinks
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="platters-tab" data-bs-toggle="pill" data-bs-target="#platters" type="button" role="tab" aria-controls="platters" aria-selected="false" data-category="platters">
                        <i class="fas fa-utensils"></i> Platters
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="snacks-tab" data-bs-toggle="pill" data-bs-target="#snacks" type="button" role="tab" aria-controls="snacks" aria-selected="false" data-category="snacks">
                        <i class="fas fa-cookie"></i> Snacks
                    </button>
                </li>
            </ul>
    
            <div class="filters-section mb-4">
                <div class="d-md-none">
                    <button class="btn btn-filter w-100" type="button" data-bs-toggle="offcanvas" data-bs-target="#filterDrawer">
                        <i class="fas fa-filter"></i> Filters and Sort
                    </button>
                </div>

                <div class="d-none d-md-block">
                    <div class="row g-3">
                        <div class="col-md-3">
                            <div class="filter-group">
                                <div class="search-wrapper">
                                    <input type="text" class="form-control" id="searchFilter" placeholder="Search products...">
                                    <i class="fas fa-search search-icon"></i>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-3">
                            <div class="filter-group">
                                <select class="form-select" id="priceFilter">
                                    <option value="">Price Range</option>
                                    <option value="0-50">€0 - €50</option>
                                    <option value="51-100">€51 - €100</option>
                                    <option value="101-200">€101 - €200</option>
                                    <option value="201+">€201+</option>
                                </select>
                            </div>
                        </div>

                        <div class="col-md-3">
                            <div class="filter-group">
                                <select class="form-select" id="sortFilter">
                                    <option value="">Sort By</option>
                                    <option value="price-asc">Price: Low to High</option>
                                    <option value="price-desc">Price: High to Low</option>
                                    <option value="name-asc">Name: A to Z</option>
                                    <option value="name-desc">Name: Z to A</option>
                                </select>
                            </div>
                        </div>

                        <div class="col-md-3">
                            <div class="filter-group">
                                <select class="form-select" id="subCategoryFilter">
                                    <option value="">All Categories</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="offcanvas offcanvas-start" tabindex="-1" id="filterDrawer">
                    <div class="offcanvas-header">
                        <h5 class="offcanvas-title">Filters & Sort</h5>
                        <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                    </div>
                    <div class="offcanvas-body">
                        <div class="mobile-filters">
                            <div class="filter-group">
                                <label class="filter-label">Search</label>
                                <input type="text" class="form-control" id="searchFilterMobile" placeholder="Search products...">
                                <i class="fas fa-search search-icon"></i>
                            </div>

                            <div class="filter-group">
                                <label class="filter-label">Price Range</label>
                                <select class="form-select" id="priceFilterMobile">
                                    <option value="">All Prices</option>
                                    <option value="0-50">€0 - €50</option>
                                    <option value="51-100">€51 - €100</option>
                                    <option value="101-200">€101 - €200</option>
                                    <option value="201+">€201+</option>
                                </select>
                            </div>

                            <div class="filter-group">
                                <label class="filter-label">Sort By</label>
                                <select class="form-select" id="sortFilterMobile">
                                    <option value="">Featured</option>
                                    <option value="price-asc">Price: Low to High</option>
                                    <option value="price-desc">Price: High to Low</option>
                                    <option value="name-asc">Name: A to Z</option>
                                    <option value="name-desc">Name: Z to A</option>
                                </select>
                            </div>

                            <div class="filter-group">
                                <label class="filter-label">Category</label>
                                <select class="form-select" id="subCategoryFilterMobile">
                                    <option value="">All Categories</option>
                                </select>
                            </div>

                            <div class="filter-actions">
                                <button class="btn btn-secondary" type="button" onclick="clearFilters()">Clear All</button>
                                <button class="btn btn-primary" type="button" onclick="applyMobileFilters()" data-bs-dismiss="offcanvas">Apply Filters</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>   
        
            <div class="tab-content" id="cateringContent">
                <div class="tab-pane fade show active" id="drinks" role="tabpanel" aria-labelledby="drinks-tab">
                    <div class="row" id="drinksContainer"></div>
                    <div class="pagination-container"></div>
                </div>
                <div class="tab-pane fade" id="platters" role="tabpanel" aria-labelledby="platters-tab">
                    <div class="row" id="plattersContainer"></div>
                    <div class="pagination-container"></div>
                </div>
                <div class="tab-pane fade" id="snacks" role="tabpanel" aria-labelledby="snacks-tab">
                    <div class="row" id="snacksContainer"></div>
                    <div class="pagination-container"></div>
                </div>
            </div>
    
            <div class="order-summary" id="orderSummary">
                <button class="close-btn-mobile" onclick="hideMobileOrderSummary()" aria-label="Close shopping cart and resume scrolling">
                    &times; <span class="close-cart-text">Close Cart</span>
                </button>
                <div class="summary-header">
                    <h3>Your Order</h3>
                    <span class="item-count">0 items</span>
                </div>
                <div class="summary-items"></div>
                <div class="summary-total">
                    <div class="total-label">Total</div>
                    <div class="total-amount">€0.00</div>
                </div>
                <button class="btn-checkout" id="proceedToCheckout" disabled>Proceed to Checkout</button>
            </div>
        </div>
    </section>
    
    <div class="modal fade" id="checkoutModal" tabindex="-1" aria-labelledby="checkoutModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="checkoutModalLabel">Order Summary</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div id="checkoutSummary">
                <h6>Your Selected Items:</h6>
                <ul class="list-group" id="checkoutItems"></ul>
              </div>
              <div class="mt-3">
                <label for="fullName" class="mt-2">Full Name:</label>
                <input type="text" id="fullName" class="form-control" placeholder="Enter your full name">
                <label for="boatName" class="mt-2">Boat Name:</label>
                <input type="text" id="boatName" class="form-control" placeholder="Enter boat name">
                <label for="rentalCompany" class="mt-2">Rental Company:</label>
                <input type="text" id="rentalCompany" class="form-control" placeholder="Enter rental company name">
                
                <div class="mt-3">
                  <label>Delivery Location:</label>
                  <div class="form-check mt-1">
                    <input class="form-check-input" type="radio" name="locationOption" id="locationKnown" value="known" checked>
                    <label class="form-check-label" for="locationKnown">
                      I know which marina my boat is located at
                    </label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="locationOption" id="locationUnknown" value="unknown">
                    <label class="form-check-label" for="locationUnknown">
                      I'm not sure where my boat will be docked
                    </label>
                  </div>
                  
                  <div id="knownLocationFields" class="mt-2">
                    <select id="marinaLocation" class="form-control">
                      <option value="Marina Ibiza">Marina Ibiza</option>
                    </select>
                    <input type="text" id="berthNumber" class="form-control mt-2" placeholder="Berth Number (e.g., A-12)">
                    <input type="text" id="berthName" class="form-control mt-2" placeholder="Berth Name (Optional)">
                  </div>
                  
                  <div id="unknownLocationFields" class="mt-2 d-none">
                    <div class="alert alert-info p-2">
                      <small><i class="fas fa-info-circle"></i> Delivery is currently restricted to Marina Ibiza. Please ensure your boat is located there. We will contact you to coordinate delivery details.</small>
                    </div>
                    <div class="form-check mt-2">
                      <input class="form-check-input" type="checkbox" id="contactRental" checked>
                      <label class="form-check-label" for="contactRental">
                        I authorize contacting the rental company for boat location
                      </label>
                    </div>
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" id="contactMe">
                      <label class="form-check-label" for="contactMe">
                        Please call me to discuss delivery details
                      </label>
                    </div>
                  </div>
                </div>
                
                <label for="phoneNumber" class="mt-2">Phone Number:</label>
                <input type="text" id="phoneNumber" class="form-control" placeholder="Enter phone number">
                <label for="email" class="mt-2">Email:</label>
                <input type="email" id="email" class="form-control" placeholder="Enter your email">
                <label for="orderDate" class="mt-2">Delivery Date:</label>
                <input type="date" id="orderDate" class="form-control">
                <label for="paymentMethod" class="mt-2">Payment Method:</label>
                <select id="paymentMethod" class="form-control">
                  <option value="card">Credit/Debit Card</option>
                </select>
                <label for="specialNotes" class="mt-2">Special Notes:</label>
                <textarea id="specialNotes" class="form-control" placeholder="Any additional info..."></textarea>
              </div>
              <div class="mt-3">
                <h5>Total: <span id="checkoutTotal">€0.00</span></h5>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="button" class="btn btn-primary" onclick="submitOrder()">Confirm Order</button>
            </div>
          </div>
        </div>
    </div>

    <div class="modal fade" id="ingredientsModal" tabindex="-1" aria-labelledby="ingredientsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="ingredientsModalLabel">Platter Contents</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <ul id="ingredientsList" class="list-group list-group-flush">
                        </ul>
                </div>
            </div>
        </div>
    </div>
  
    <a href="https://wa.me/34692688348" class="elegant-whatsapp" target="_blank">
      <div class="elegant-whatsapp-inner">
          <i class="fab fa-whatsapp"></i>
          <span class="elegant-whatsapp-text">Contact Us</span>
      </div>
    </a>

    <button id="mobileCartToggle" class="mobile-cart-toggle" onclick="showMobileOrderSummary()">
        <i class="fas fa-shopping-cart"></i> View Cart (<span id="mobileCartCount">0</span>)
    </button>
  
    <footer class="footer">
        <div class="footer-top">
            <div class="container">
                <div class="row">
                    <div class="col-md-4">
                        <div class="footer-column footer-about">
                            <h3 class="footer-title">About Just Enjoy Ibiza Boat</h3>
                            <p class="footer-about-text">At Just Enjoy Ibiza, we create unforgettable yacht experiences. With premium vessels and expert crews, your time on the Mediterranean will be nothing short of exceptional.</p>
                            <div class="footer-language"> <i class="lni ti-world"></i>
                                <select onchange="location = this.value;">
                                    <option value="/en">English</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 offset-md-1">
                        <div class="footer-column footer-explore clearfix">
                            <h3 class="footer-title">Discover</h3>
                            <ul class="footer-explore-list list-unstyled">
                                <li><a href="#">Home</a></li>
                                <li><a href="yacht-rental.html">Our Fleet</a></li>
                                <li><a href="yacht-rental.html">Day Charters</a></li>
                                <li><a href="services.html">Food & Drinks Boat Delivery</a></li>
                                <li><a href="contact.html">Contact</a></li>
                                <li><a href="about.html">About Us</a></li>
                                <li><a href="faq.html">FAQ</a></li>
                                <li><a href="news.html">News</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="footer-column footer-contact">
                            <h3 class="footer-title">Contact</h3>
                            <p class="footer-contact-text">Marina Botafoch<br>07800 Ibiza, Balearic Islands<br>Spain</p>
                            <div class="footer-contact-info">
                                <p class="footer-contact-phone"><span class="flaticon-call"></span> +34 692 688 348</p>
                                <p class="footer-contact-mail">info@justenjoyibizaboats.com</p>
                            </div>
                            <div class="footer-about-social-list">
                                <a href="https://www.instagram.com/justenjoyibiza_boats_tours/" target="_blank" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                                <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                                <a href="#" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
                                <a href="https://wa.me/34692688348" target="_blank" aria-label="WhatsApp"><i class="fab fa-whatsapp"></i></a>
                                <a href="#" aria-label="TikTok"><i class="fab fa-tiktok"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    
    <script src="https://code.jquery.com/jquery-3.6.3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script src="/assets/js/jquery-migrate-3.0.0.min.js"></script>
    <script src="/assets/js/modernizr-2.6.2.min.js"></script>
    <script src="/assets/js/imagesloaded.pkgd.min.js"></script>
    <script src="/assets/js/jquery.isotope.v3.0.2.js"></script>
    <script src="/assets/js/pace.js"></script>
    <script src="/assets/js/scrollIt.min.js"></script>
    <script src="/assets/js/jquery.waypoints.min.js"></script>
    <script src="/assets/js/owl.carousel.min.js"></script>
    <script src="/assets/js/jquery.stellar.min.js"></script>
    <script src="/assets/js/jquery.magnific-popup.js"></script>
    <script src="/assets/js/YouTubePopUp.js"></script>
    <script src="/assets/js/select2.js"></script>
    <script src="/assets/js/datepicker.js"></script>
    <script src="/assets/js/smooth-scroll.min.js"></script>
    <script src="/assets/js/custom.js"></script>

    <script>
        // Global variables
        var servicesDb;
        var allProducts = {}; // Store all fetched products by category
        var currentProducts = []; // Products for the currently active tab
        var cart = [];
        var currentCategory = 'drinks';
        
        // UPDATED: Add Stripe initialization 
        const stripe = Stripe('pk_live_51QmynnDMhcF3s2QS90R7gQ0zvmO3OGrBM8H528l1zih6Hogdfy8MVb3yvOBfRbbjdp8N0EyUiN853AfxDby6Ihd5002Ma68UcI');

        // Initialize Firebase
        async function initializeFirebase() {
            try {
                console.log('🔥 Initializing Firebase for services...');
                const response = await fetch('/api/firebase-config');
                const firebaseConfig = await response.json();
                
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                }
                
                servicesDb = firebase.firestore();
                console.log('✅ Firebase initialized successfully');
                return true;
            } catch (error) {
                console.error('❌ Firebase initialization failed:', error);
                return false;
            }
        }

        // Load products from Firebase
        async function loadProducts(category = 'drinks') {
            console.log(`🔄 Loading ${category} products...`);
            
            const container = document.getElementById(`${category}Container`); 
            
            if (!container) {
                console.error(`❌ Container not found for ${category}Container`);
                return;
            }

            container.innerHTML = `
                <div class="col-12">
                    <div class="loading-spinner">
                        <div class="spinner"></div>
                        <p style="margin-left: 15px; color: #2095AE;">Loading ${category}...</p>
                    </div>
                </div>
            `;

            try {
                if (!servicesDb) {
                    throw new Error('Firebase not initialized');
                }

                const categoryMap = {
                    'drinks': 'drinks',
                    'platters': 'packages', 
                    'snacks': 'snacks'
                };

                const dbCollectionName = categoryMap[category] || category; 
                
                const snapshot = await servicesDb.collection('products')
                    .where('category', '==', dbCollectionName) 
                    .where('isActive', '==', true)
                    .get();
                
                container.innerHTML = '';
                
                if (snapshot.empty) {
                    container.innerHTML = `
                        <div class="col-12 text-center">
                            <div style="padding: 50px; color: #333;">
                                <i class="fas fa-${getIconForCategory(category)}" style="font-size: 3rem; color: #2095AE; margin-bottom: 20px;"></i>
                                <h4 style="color: #333; margin-bottom: 15px; font-family: 'Gilda Display', serif;">No ${category} Available</h4>
                                <p style="color: #666;">Check back soon for new products.</p>
                            </div>
                        </div>
                    `;
                    allProducts[category] = []; // Store empty array if no products
                    populateSubCategories(category); // Clear sub-categories
                    return;
                }
                
                console.log(`📦 Found ${snapshot.size} ${category} products`);
                currentProducts = [];
                
                snapshot.forEach((doc) => {
                    const product = { id: doc.id, ...doc.data() };
                    currentProducts.push(product);
                });
                allProducts[category] = [...currentProducts]; // Store a copy of all products for this category

                populateSubCategories(category); // Populate sub-categories for the loaded products
                applyFilters(); // Apply filters after loading products
                updateQuantitiesFromCart();
                console.log(`✅ ${category} loaded successfully!`);
                
            } catch (error) {
                console.error(`❌ Error loading ${category}:`, error);
                showError(container, category);
            }
        }

        function renderProducts(products, container) {
            container.innerHTML = '';
            
            if (products.length === 0) {
                container.innerHTML = `
                    <div class="col-12 text-center">
                        <div style="padding: 50px; color: #333;">
                            <i class="fas fa-search-minus" style="font-size: 3rem; color: #2095AE; margin-bottom: 20px;"></i>
                            <h4 style="color: #333; margin-bottom: 15px; font-family: 'Gilda Display', serif;">No Products Match Your Filters</h4>
                            <p style="color: #666;">Try adjusting your search or filter criteria.</p>
                        </div>
                    </div>
                `;
                return;
            }

            products.forEach((product, index) => {
                const col = document.createElement('div');
                col.className = 'col-lg-4 col-md-6 mb-4';
                col.style.animationDelay = `${index * 0.1}s`;
                
                const fallbackImage = 'https://placehold.co/400x200/2095AE/ffffff?text=No+Image';
                let productImage = product.imageUrl || fallbackImage;
                
                if (productImage.includes('.heic')) {
                    productImage = fallbackImage;
                }
                
                const contentsList = product.contents ? 
                    product.contents.split('•').map(item => item.trim()).filter(item => item.length > 0) : [];
                
                // UPDATED: Move price to content area instead of overlay
                col.innerHTML = `
                    <div class="product-card" data-product-id="${product.id}">
                        <div class="product-image-container">
                            <img src="${productImage}" 
                                 alt="${product.name}" 
                                 onerror="this.src='${fallbackImage}';"
                                 loading="lazy"
                                 class="product-image">
                            <!-- REMOVED: Price overlay no longer here -->
                        </div>
                        
                        <div class="product-content">
                            <h3 class="product-name">${product.name}</h3>
                            <!-- NEW: Price prominently displayed in content -->
                            <div class="product-price">€${product.price}</div>
                            <p class="product-description">${product.description || ''}</p>
                            
                            ${contentsList.length > 0 ? `
                                <div class="contents-preview">
                                    <div class="contents-title">Includes</div>
                                    <div class="contents-list">
                                        ${contentsList.slice(0, 4).map(item => `
                                            <span class="content-tag">${item}</span>
                                        `).join('')}
                                        ${contentsList.length > 4 ? `
                                            <button class="content-tag view-all-btn" onclick="showAllIngredients('${product.id}')">
                                                +${contentsList.length - 4} more
                                            </button>
                                        ` : ''}
                                    </div>
                                </div>
                            ` : ''}
                            
                            <div class="product-actions">
                                <div class="quantity-controls">
                                    <button class="qty-btn" onclick="updateQuantity('${product.id}', -1)">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                    <span class="quantity-display" id="qty-${product.id}">0</span>
                                    <button class="qty-btn" onclick="updateQuantity('${product.id}', 1)">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                                
                                <button class="add-to-cart-btn" onclick="addToCart('${product.id}')">
                                    <i class="fas fa-shopping-cart"></i>
                                    <span>Add</span>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                container.appendChild(col);
            });
        }

        function updateQuantity(productId, change) {
            const qtyElement = document.getElementById(`qty-${productId}`);
            if (!qtyElement) {
                console.warn(`Quantity element not found for product ID: ${productId}`);
                return;
            }
            
            let currentQty = parseInt(qtyElement.textContent) || 0;
            let newQty = Math.max(0, currentQty + change);
            
            qtyElement.textContent = newQty;
            // IMPORTANT: Do not update cart, display, or save here.
            // This function only updates the local quantity display on the card.
        }

        function addToCart(productId) {
            const qtyElement = document.getElementById(`qty-${productId}`);
            if (!qtyElement) {
                console.warn(`Quantity element not found for product ID: ${productId}`);
                return;
            }

            let quantityToAdd = parseInt(qtyElement.textContent) || 0;

            if (quantityToAdd <= 0) {
                showCustomAlert('Please select a quantity greater than 0 to add to cart.');
                return;
            }
            
            const product = allProducts[currentCategory].find(p => p.id === productId); // Use allProducts for adding to cart
            if (!product) {
                console.error(`Product with ID ${productId} not found in currentProducts.`);
                return;
            }

            const existingCartItemIndex = cart.findIndex(item => item.id === productId);

            if (existingCartItemIndex >= 0) {
                cart[existingCartItemIndex].quantity += quantityToAdd;
            } else {
                cart.push({
                    id: productId,
                    name: product.name,
                    price: parseFloat(product.price),
                    quantity: quantityToAdd
                });
            }
            
            // Reset quantity display on the product card after adding to cart
            qtyElement.textContent = '0';

            updateCartDisplay();
            saveCart();

            // --- Add to Cart Visual Feedback ---
            const productCard = document.querySelector(`.product-card[data-product-id="${productId}"]`);
            if (productCard) {
                const productActions = productCard.querySelector('.product-actions');
                let feedbackSpan = productActions.querySelector('.add-to-cart-feedback');

                // Remove existing feedback if any
                if (feedbackSpan) {
                    feedbackSpan.remove();
                }

                feedbackSpan = document.createElement('span');
                feedbackSpan.textContent = 'Added!';
                feedbackSpan.classList.add('add-to-cart-feedback');
                
                // Append it after the add button
                const addButton = productActions.querySelector('.add-to-cart-btn');
                if (addButton) {
                    productActions.insertBefore(feedbackSpan, addButton.nextSibling);
                } else {
                    productActions.appendChild(feedbackSpan);
                }

                // Start fade out after a short delay
                setTimeout(() => {
                    feedbackSpan.classList.add('fade-out');
                }, 500); // Start fading after 0.5 seconds

                // Remove the element completely after the transition
                feedbackSpan.addEventListener('transitionend', function handler() {
                    feedbackSpan.removeEventListener('transitionend', handler);
                    feedbackSpan.remove();
                });
            }
            // --- End Add to Cart Visual Feedback ---
        }

        // New function to update quantity directly in the cart
        function updateCartItemQuantity(productId, change) {
            const itemIndex = cart.findIndex(item => item.id === productId);

            if (itemIndex > -1) {
                let currentQty = cart[itemIndex].quantity;
                let newQty = currentQty + change;

                if (newQty <= 0) {
                    // Remove item if quantity goes to 0 or below
                    cart.splice(itemIndex, 1);
                } else {
                    cart[itemIndex].quantity = newQty;
                }
                updateCartDisplay();
                saveCart();

                // Also update the quantity display on the product card if it's currently rendered
                const productCardQtyElement = document.getElementById(`qty-${productId}`);
                if (productCardQtyElement) {
                    productCardQtyElement.textContent = newQty > 0 ? newQty : '0';
                }
            }
        }

        function updateCartDisplay() {
            const orderSummary = document.getElementById('orderSummary');
            const itemCount = document.querySelector('.item-count');
            const summaryItems = document.querySelector('.summary-items');
            const totalAmount = document.querySelector('.total-amount');
            const checkoutBtn = document.getElementById('proceedToCheckout');
            const mobileCartToggle = document.getElementById('mobileCartToggle');
            const mobileCartCount = document.getElementById('mobileCartCount');
            const checkoutItemsList = document.getElementById('checkoutItems'); // For checkout modal

            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            const total = cart.reduce((sum, item) => sum + (item.quantity * item.price), 0);
            
            if (itemCount) {
                itemCount.textContent = `${totalItems} item${totalItems !== 1 ? 's' : ''}`;
            }
            
            if (summaryItems) {
                summaryItems.innerHTML = '';
                cart.forEach(item => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'summary-item';
                    itemDiv.innerHTML = `
                        <div class="item-info">
                            <span class="item-name">${item.name}</span>
                            <span class="item-details">€${item.price.toFixed(2)} / item</span>
                        </div>
                        <div class="quantity-controls-cart">
                            <button class="qty-btn-cart" onclick="updateCartItemQuantity('${item.id}', -1)">
                                <i class="fas fa-minus"></i>
                            </button>
                            <span class="quantity-display-cart">${item.quantity}</span>
                            <button class="qty-btn-cart" onclick="updateCartItemQuantity('${item.id}', 1)">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <div class="item-total">€${(item.quantity * item.price).toFixed(2)}</div>
                    `;
                    summaryItems.appendChild(itemDiv);
                });
            }

            
          if (checkoutItemsList) {
              checkoutItemsList.innerHTML = '';
              cart.forEach(item => {
                  const li = document.createElement('li');
                  li.className = 'list-group-item d-flex justify-content-between align-items-center';
                  li.innerHTML = `
                      <div>
                          <span class="item-name">${item.name}</span>
                          <small class="text-muted d-block">Quantity: <span class="item-quantity" data-quantity="${item.quantity}">${item.quantity}</span></small>
                      </div>
                      <span class="item-price" data-price="${item.price}">€${(item.quantity * item.price).toFixed(2)}</span>
                  `;
                  li.dataset.id = item.id;
                  checkoutItemsList.appendChild(li);
              });
          }

          // Update checkout modal total
          const checkoutTotal = document.getElementById('checkoutTotal');
          if (checkoutTotal) {
              checkoutTotal.textContent = `€${total.toFixed(2)}`;
          }
            
            if (totalAmount) {
                totalAmount.textContent = `€${total.toFixed(2)}`;
            }
            
            if (checkoutBtn) {
                checkoutBtn.disabled = cart.length === 0;
            }

            if (mobileCartCount) {
                mobileCartCount.textContent = totalItems;
            }

            // Logic for showing/hiding mobile cart toggle and order summary
            if (window.innerWidth <= 768) { // Mobile view
                const isSummaryOpen = orderSummary.classList.contains('show-mobile');

                if (totalItems > 0) {
                    mobileCartToggle.style.display = isSummaryOpen ? 'none' : 'flex';
                    if (!isSummaryOpen) {
                        orderSummary.style.display = 'none'; // Keep summary hidden if not explicitly open
                    }
                } else { // totalItems is 0
                    mobileCartToggle.style.display = 'flex'; // Always show toggle if cart is empty
                    if (isSummaryOpen) {
                        // If summary was open and became empty, keep it open but update content
                        orderSummary.style.display = 'block'; 
                    } else {
                        orderSummary.style.display = 'none'; // Keep summary hidden if not explicitly open
                    }
                }
            } else { // Desktop view
                mobileCartToggle.style.display = 'none'; // Always hide mobile toggle on desktop
                orderSummary.style.display = cart.length > 0 ? 'block' : 'none'; // Show/hide summary based on cart content
                orderSummary.classList.remove('show-mobile'); // Ensure mobile class is removed on desktop
            }
        }

        function saveCart() {
            localStorage.setItem('yacht-catering-cart', JSON.stringify(cart));
        }

        function loadSavedCart() {
            const savedCart = localStorage.getItem('yacht-catering-cart');
            if (savedCart) {
                cart = JSON.parse(savedCart);
                updateCartDisplay();
            }
        }

        function updateQuantitiesFromCart() {
            // This function is called after products are loaded to reflect quantities from the cart
            cart.forEach(item => {
                const qtyElement = document.getElementById(`qty-${item.id}`);
                if (qtyElement) {
                    qtyElement.textContent = item.quantity;
                }
            });
        }

        function getIconForCategory(category) {
            const icons = {
                'drinks': 'glass-martini-alt',
                'platters': 'utensils',
                'snacks': 'cookie',
                'packages': 'utensils'
            };
            return icons[category] || 'box';
        }

        function showError(container, category) {
            container.innerHTML = `
                <div class="col-12 text-center">
                    <div style="padding: 50px; color: #333;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: #2095AE; margin-bottom: 20px;"></i>
                        <h4 style="color: #333; margin-bottom: 15px; font-family: 'Gilda Display', serif;">Unable to Load ${category}</h4>
                        <p style="color: #666;">Please refresh the page to try again.</p>
                        <button onclick="window.location.reload()" 
                                style="background: #2095AE; color: white; border: none; padding: 10px 20px; margin-top: 10px; cursor: pointer; font-family: 'Barlow Condensed', sans-serif; text-transform: uppercase; letter-spacing: 2px;">
                            Refresh Page
                        </button>
                    </div>
                </div>
            `;
        }

        // Tab handling
        function setupTabHandlers() {
            const tabButtons = document.querySelectorAll('[data-bs-toggle="pill"]');
            tabButtons.forEach(button => {
                button.addEventListener('click', async function(e) {
                    e.preventDefault();
                    
                    const category = this.getAttribute('data-category');
                    if (!category) return;
                    
                    console.log(`🎯 Tab clicked: ${category}`);
                    
                    document.querySelectorAll('.nav-link').forEach(tab => tab.classList.remove('active'));
                    document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active', 'show'));
                    
                    this.classList.add('active');
                    const targetPane = document.querySelector(this.getAttribute('data-bs-target'));
                    if (targetPane) {
                        targetPane.classList.add('active', 'show');
                    }
                    
                    currentCategory = category;
                    await loadProducts(category);
                });
            });
        }

        // Checkout
        function setupCheckout() {
            const checkoutBtn = document.getElementById('proceedToCheckout');
            if (checkoutBtn) {
                checkoutBtn.addEventListener('click', function() {
                    // The checkoutItems and checkoutTotal are now updated by updateCartDisplay()
                    // so no need to duplicate logic here.
                    const modal = new bootstrap.Modal(document.getElementById('checkoutModal'));
                    modal.show();
                });
            }
        }

        // Submit order function
        // Updated submitOrder function with proper location data structure
function submitOrder() {
    const confirmBtn = document.querySelector('.modal-footer .btn-primary');
    const originalText = confirmBtn.textContent;
    confirmBtn.disabled = true;
    confirmBtn.innerHTML = '<span class="spinner-border spinner-border-sm mr-2" role="status" aria-hidden="true"></span> Processing...';

    const email = document.getElementById('email').value;
    
    // Base order data
    const orderData = {
        cart: getCartItems(),
        fullName: document.getElementById('fullName').value,
        boatName: document.getElementById('boatName').value || 'Not specified',
        rentalCompany: document.getElementById('rentalCompany').value || 'Not specified',
        phoneNumber: document.getElementById('phoneNumber').value,
        customerEmail: email,
        email: email,
        orderDate: document.getElementById('orderDate').value,
        specialNotes: document.getElementById('specialNotes').value || '',
        paymentMethod: document.getElementById('paymentMethod').value
    };

    const locationKnownRadio = document.getElementById('locationKnown');
    const locationUnknownRadio = document.getElementById('locationUnknown');

    if (locationKnownRadio && locationKnownRadio.checked) {
        // Known location - Marina Ibiza
        const berthNumber = document.getElementById('berthNumber').value;
        const berthName = document.getElementById('berthName').value;
        const marinaLocation = document.getElementById('marinaLocation').value;
        
        if (!berthNumber) {
            showCustomAlert('Please enter the Berth Number for Marina Ibiza delivery.');
            confirmBtn.disabled = false;
            confirmBtn.textContent = originalText;
            return;
        }

        // Structure location data properly for Firebase and display
        orderData.boatLocation = marinaLocation; // Main location field
        orderData.marina = marinaLocation; // Marina name
        orderData.berthNumber = berthNumber; // Berth number
        orderData.berthName = berthName || ''; // Berth name (optional)
        
        // Create full delivery address for display
        let deliveryAddress = marinaLocation;
        if (berthNumber) {
            deliveryAddress += `, Berth ${berthNumber}`;
        }
        if (berthName) {
            deliveryAddress += ` (${berthName})`;
        }
        orderData.deliveryAddress = deliveryAddress;
        
        // Legacy field for compatibility
        orderData.deliveryLocation = 'Marina Ibiza';
        
    } else if (locationUnknownRadio && locationUnknownRadio.checked) {
        // Unknown location - coordination needed
        const contactRental = document.getElementById('contactRental').checked;
        const contactMe = document.getElementById('contactMe').checked;
        
        if (!contactMe && !contactRental) {
            showCustomAlert('Please select at least one contact method for delivery coordination.');
            confirmBtn.disabled = false;
            confirmBtn.textContent = originalText;
            return;
        }

        // Structure location data for coordination case
        orderData.boatLocation = 'Marina Ibiza (Location TBD)';
        orderData.marina = 'Marina Ibiza';
        orderData.deliveryAddress = 'Marina Ibiza - Coordination Required';
        orderData.deliveryInstructions = 'Location coordination needed before delivery';
        orderData.contactRental = contactRental;
        orderData.contactMe = contactMe;
        
        // Legacy field for compatibility
        orderData.deliveryLocation = 'Marina Ibiza (Coordination Needed)';
    }

    // Validation
    if (!orderData.fullName || !orderData.phoneNumber || !orderData.email) {
        showCustomAlert('Please fill in all required fields.');
        confirmBtn.disabled = false;
        confirmBtn.textContent = originalText;
        return;
    }

    // Add additional fields that might be useful for orders management
    orderData.orderSource = 'Website';
    orderData.createdAt = new Date().toISOString();
    orderData.updatedAt = new Date().toISOString();
    orderData.status = 'pending';
    
    // Calculate total
    orderData.amount_total = cart.reduce((sum, item) => sum + (item.quantity * item.price), 0);
    orderData.currency = 'eur';

    // Create items array with proper structure
    orderData.items = cart.map(item => ({
        id: item.id,
        name: item.name,
        price: parseFloat(item.price),
        quantity: parseInt(item.quantity)
    }));

    console.log('Submitting order data:', orderData); // For debugging

    const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
    const endpoint = isLocalhost 
        ? 'http://localhost:5001/crm-boats/us-central1/apiNew/checkout'
        : 'https://us-central1-crm-boats.cloudfunctions.net/apiNew/checkout';

    fetch(endpoint, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(orderData)
    })
    .then(response => {
        if (!response.ok) {
            return response.text().then(text => {
                throw new Error(`Network response was not ok: ${response.status}`);
            });
        }
        return response.json();
    })
    .then(data => {
        if (data.sessionId) {
            stripe.redirectToCheckout({ sessionId: data.sessionId });
        } else {
            throw new Error('No session ID returned');
        }
    })
    .catch(error => {
        console.error('Payment error:', error);
        showCustomAlert('Payment processing failed. Please try again.');
        confirmBtn.disabled = false;
        confirmBtn.textContent = originalText;
    });
}

        function getCartItems() {
            return cart.map(item => ({
                id: item.id,
                name: item.name,
                price: item.price,
                quantity: item.quantity
            }));
        }

        function showCustomAlert(message) {
            let alertBox = document.getElementById('customAlertBox');
            if (!alertBox) {
                alertBox = document.createElement('div');
                alertBox.id = 'customAlertBox';
                alertBox.style.cssText = `
                    position: fixed;
                    top: 20px;
                    left: 50%;
                    transform: translateX(-50%);
                    background-color: #ff4444;
                    color: white;
                    padding: 15px 25px;
                    border-radius: 8px;
                    z-index: 10000;
                    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                    display: none;
                    font-family: 'Barlow', sans-serif;
                    font-size: 16px;
                    opacity: 0;
                    transition: opacity 0.3s ease-in-out;
                `;
                document.body.appendChild(alertBox);
            }
            alertBox.textContent = message;
            alertBox.style.display = 'block';
            setTimeout(() => {
                alertBox.style.opacity = 1;
            }, 10);
            setTimeout(() => {
                alertBox.style.opacity = 0;
                alertBox.addEventListener('transitionend', function handler() {
                    alertBox.style.display = 'none';
                    alertBox.removeEventListener('transitionend', handler);
                });
            }, 3000);
        }

        function setupHamburgerMenu() {
            const toggler = document.querySelector('.custom-toggler');
            const navCollapse = document.querySelector('.navbar-collapse');
        
            if (toggler && navCollapse) {
                let isAnimating = false;
        
                toggler.addEventListener('click', function(e) {
                    e.preventDefault();
                    if (isAnimating) return;
                    
                    isAnimating = true;
                    this.classList.toggle('active');
                    navCollapse.classList.toggle('show');
                    
                    document.body.classList.toggle('menu-open');
                    document.body.style.overflow = navCollapse.classList.contains('show') ? 'hidden' : '';
                    
                    setTimeout(() => {
                        isAnimating = false;
                    }, 400);
                });
        
                const navLinks = navCollapse.querySelectorAll('.nav-link');
                navLinks.forEach(link => {
                    if(link.id === 'servicesDropdownToggle') return;
                    link.addEventListener('click', () => {
                        if (isAnimating) return;
                        toggler.classList.remove('active');
                        navCollapse.classList.remove('show');
                        document.body.classList.remove('menu-open');
                        document.body.style.overflow = '';
                    });
                });
        
                document.addEventListener('click', function(e) {
                    if (!isAnimating &&
                        !toggler.contains(e.target) &&
                        !navCollapse.contains(e.target) &&
                        navCollapse.classList.contains('show')) {
                        toggler.classList.remove('active');
                        navCollapse.classList.remove('show');
                        document.body.classList.remove('menu-open');
                        document.body.style.overflow = '';
                    }
                });
        
                navCollapse.addEventListener('click', function(e) {
                    if (e.target === navCollapse) {
                        toggler.classList.remove('active');
                        navCollapse.classList.remove('show');
                        document.body.classList.remove('menu-open');
                        document.body.style.overflow = '';
                    }
                });
        
                window.addEventListener('resize', function() {
                    if (window.innerWidth >= 992) {
                        document.body.classList.remove('menu-open');
                        document.body.style.overflow = '';
                    }
                });
            }
        
            const servicesDropdownToggle = document.getElementById('servicesDropdownToggle');
            if (servicesDropdownToggle) {
                servicesDropdownToggle.addEventListener('click', function(e) {
                    if (window.innerWidth < 992) {
                        e.preventDefault();
                        e.stopPropagation();
                        const parentDropdown = this.closest('.dropdown');
                        if (parentDropdown) {
                            parentDropdown.classList.toggle('open');
                        }
                    }
                });
            }
        }

        function setupCheckoutForm() {
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            
            const formatDate = (date) => {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            };
            
            const orderDateInput = document.getElementById('orderDate');
            if (orderDateInput) {
                orderDateInput.min = formatDate(today);
                orderDateInput.value = formatDate(tomorrow);
            }
            
            const locationKnown = document.getElementById('locationKnown');
            const locationUnknown = document.getElementById('locationUnknown');
            const knownLocationFields = document.getElementById('knownLocationFields');
            const unknownLocationFields = document.getElementById('unknownLocationFields');
            
            // Function to toggle visibility
            const toggleLocationFields = () => {
                if (locationKnown.checked) {
                    knownLocationFields.classList.remove('d-none');
                    unknownLocationFields.classList.add('d-none');
                } else {
                    knownLocationFields.classList.add('d-none');
                    unknownLocationFields.classList.remove('d-none');
                }
            };

            // Add event listeners
            if (locationKnown) {
                locationKnown.addEventListener('change', toggleLocationFields);
            }
            if (locationUnknown) {
                locationUnknown.addEventListener('change', toggleLocationFields);
            }

            // Initial state based on default checked radio (locationKnown is default checked in HTML)
            toggleLocationFields();
        }

        // Functions to show/hide mobile order summary
        function showMobileOrderSummary() {
            const orderSummary = document.getElementById('orderSummary');
            const mobileCartToggle = document.getElementById('mobileCartToggle');
            if (orderSummary) {
                orderSummary.style.display = 'block'; 
                orderSummary.classList.add('show-mobile');
                document.body.style.overflow = 'hidden'; 
                if (mobileCartToggle) {
                    mobileCartToggle.style.display = 'none'; // Hide the toggle button when summary is open
                }
            }
        }

        function hideMobileOrderSummary() {
            const orderSummary = document.getElementById('orderSummary');
            const mobileCartToggle = document.getElementById('mobileCartToggle');
            if (orderSummary) {
                orderSummary.classList.remove('show-mobile');
                orderSummary.addEventListener('transitionend', function handler() {
                    orderSummary.style.display = 'none';
                    document.body.style.overflow = ''; 
                    orderSummary.removeEventListener('transitionend', handler);
                    // Re-evaluate display of mobile cart toggle after summary is hidden
                    if (mobileCartToggle && cart.length > 0 && window.innerWidth <= 768) {
                        mobileCartToggle.style.display = 'flex';
                    }
                }, {once: true}); // Use {once: true} to ensure the event listener is removed after it fires once
            }
        }

        // Function to show all ingredients in a modal
        function showAllIngredients(productId) {
            const product = allProducts[currentCategory].find(p => p.id === productId); // Use allProducts for ingredients
            if (!product || !product.contents) {
                console.error('Product or contents not found for ingredients modal.');
                return;
            }

            const ingredientsListElement = document.getElementById('ingredientsList');
            if (ingredientsListElement) {
                ingredientsListElement.innerHTML = ''; // Clear previous ingredients
                const allIngredients = product.contents.split('•').map(item => item.trim()).filter(item => item.length > 0);
                allIngredients.forEach(ingredient => {
                    const li = document.createElement('li');
                    li.className = 'list-group-item';
                    li.textContent = ingredient;
                    ingredientsListElement.appendChild(li);
                });

                const ingredientsModal = new bootstrap.Modal(document.getElementById('ingredientsModal'));
                ingredientsModal.show();
            }
        }

        // --- FILTERING AND SORTING LOGIC ---

        function getFilterValues() {
            let search = '';
            let priceRange = '';
            let sortOrder = '';
            let subCategory = '';

            // Prioritize mobile filters if the offcanvas is open or on a small screen
            const isMobileView = window.innerWidth <= 768;
            const filterDrawerOpen = document.getElementById('filterDrawer').classList.contains('show');

            if (isMobileView || filterDrawerOpen) {
                search = document.getElementById('searchFilterMobile').value.toLowerCase();
                priceRange = document.getElementById('priceFilterMobile').value;
                sortOrder = document.getElementById('sortFilterMobile').value;
                subCategory = document.getElementById('subCategoryFilterMobile').value;
            } else {
                search = document.getElementById('searchFilter').value.toLowerCase();
                priceRange = document.getElementById('priceFilter').value;
                sortOrder = document.getElementById('sortFilter').value;
                subCategory = document.getElementById('subCategoryFilter').value;
            }

            return { search, priceRange, sortOrder, subCategory };
        }

        function applyFilters() {
            let filteredProducts = [...allProducts[currentCategory]]; // Start with all products for the current category

            const { search, priceRange, sortOrder, subCategory } = getFilterValues();
            const container = document.getElementById(`${currentCategory}Container`);

            // 1. Filter by Search
            if (search) {
                filteredProducts = filteredProducts.filter(product =>
                    product.name.toLowerCase().includes(search) ||
                    (product.description && product.description.toLowerCase().includes(search)) ||
                    (product.contents && product.contents.toLowerCase().includes(search))
                );
            }

            // 2. Filter by Price Range
            if (priceRange) {
                const [minPriceStr, maxPriceStr] = priceRange.split('-');
                const minPrice = parseFloat(minPriceStr);
                const maxPrice = maxPriceStr ? parseFloat(maxPriceStr) : Infinity;

                filteredProducts = filteredProducts.filter(product => {
                    const price = parseFloat(product.price);
                    return price >= minPrice && price <= maxPrice;
                });
            }

            // 3. Filter by Sub-Category
            if (subCategory) {
                filteredProducts = filteredProducts.filter(product =>
                    product.subCategory && product.subCategory.toLowerCase() === subCategory.toLowerCase()
                );
            }

            // 4. Sort Products
            if (sortOrder) {
                filteredProducts.sort((a, b) => {
                    if (sortOrder === 'price-asc') {
                        return parseFloat(a.price) - parseFloat(b.price);
                    } else if (sortOrder === 'price-desc') {
                        return parseFloat(b.price) - parseFloat(a.price);
                    } else if (sortOrder === 'name-asc') {
                        return a.name.localeCompare(b.name);
                    } else if (sortOrder === 'name-desc') {
                        return b.name.localeCompare(a.name);
                    }
                    return 0;
                });
            }

            renderProducts(filteredProducts, container);
            updateQuantitiesFromCart(); // Ensure quantities from cart are reflected on filtered products
        }

        function populateSubCategories(category) {
            const subCategorySelect = document.getElementById('subCategoryFilter');
            const subCategorySelectMobile = document.getElementById('subCategoryFilterMobile');

            // Clear existing options
            subCategorySelect.innerHTML = '<option value="">All Categories</option>';
            subCategorySelectMobile.innerHTML = '<option value="">All Categories</option>';

            const productsInCurrentCategory = allProducts[category] || [];
            const subCategories = new Set();
            productsInCurrentCategory.forEach(p => {
                if (p.subCategory) {
                    subCategories.add(p.subCategory);
                }
            });

            const sortedSubCategories = Array.from(subCategories).sort();

            sortedSubCategories.forEach(sub => {
                const optionDesktop = document.createElement('option');
                optionDesktop.value = sub;
                optionDesktop.textContent = sub;
                subCategorySelect.appendChild(optionDesktop);

                const optionMobile = document.createElement('option');
                optionMobile.value = sub;
                optionMobile.textContent = sub;
                subCategorySelectMobile.appendChild(optionMobile);
            });
        }

        function clearFilters() {
            document.getElementById('searchFilter').value = '';
            document.getElementById('priceFilter').value = '';
            document.getElementById('sortFilter').value = '';
            document.getElementById('subCategoryFilter').value = '';

            document.getElementById('searchFilterMobile').value = '';
            document.getElementById('priceFilterMobile').value = '';
            document.getElementById('sortFilterMobile').value = '';
            document.getElementById('subCategoryFilterMobile').value = '';
            
            applyFilters(); // Re-apply filters to show all products
        }

        function applyMobileFilters() {
            // This function is triggered by the "Apply Filters" button in the mobile offcanvas
            // The applyFilters() function already reads from the correct mobile inputs when the offcanvas is open.
            applyFilters();
            // The offcanvas will be dismissed by data-bs-dismiss="offcanvas" on the button itself.
        }

        // --- END FILTERING AND SORTING LOGIC ---

        // Initialize everything
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('🚀 Initializing services page...');
            
            try {
                const firebaseReady = await initializeFirebase();
                if (!firebaseReady) {
                    throw new Error('Failed to initialize Firebase');
                }
                
                loadSavedCart();
                setupTabHandlers();
                setupCheckout();
                setupHamburgerMenu();
                setupCheckoutForm(); 
                
                // Add event listeners for filters
                document.getElementById('searchFilter').addEventListener('input', applyFilters);
                document.getElementById('priceFilter').addEventListener('change', applyFilters);
                document.getElementById('sortFilter').addEventListener('change', applyFilters);
                document.getElementById('subCategoryFilter').addEventListener('change', applyFilters);

                document.getElementById('searchFilterMobile').addEventListener('input', applyFilters);
                document.getElementById('priceFilterMobile').addEventListener('change', applyFilters);
                document.getElementById('sortFilterMobile').addEventListener('change', applyFilters);
                document.getElementById('subCategoryFilterMobile').addEventListener('change', applyFilters);

                await loadProducts('drinks'); // Initial load of products for the default tab
                
                window.addEventListener('resize', updateCartDisplay);

                console.log('✅ Services page initialized successfully');
                
            } catch (error) {
                console.error('❌ Services page initialization failed:', error);
                const container = document.getElementById('drinksContainer');
                if (container) {
                    showError(container, 'products');
                }
            }
        });

        // Make functions globally available
        window.updateQuantity = updateQuantity;
        window.addToCart = addToCart;
        window.updateCartItemQuantity = updateCartItemQuantity; // Make new function globally available
        window.submitOrder = submitOrder;
        window.showMobileOrderSummary = showMobileOrderSummary; 
        window.hideMobileOrderSummary = hideMobileOrderSummary; 
        window.showAllIngredients = showAllIngredients; 
        window.clearFilters = clearFilters; // Make clearFilters available globally
        window.applyMobileFilters = applyMobileFilters; // Make applyMobileFilters available globally
    </script>
    <script>
      // Pagination variables
let currentPage = 1;
let itemsPerPage = 9; // 3 rows of 3 items each
let filteredProducts = [];

// Update renderProducts function to handle pagination
function renderProducts(products, container) {
    filteredProducts = [...products]; // Store filtered products for pagination
    currentPage = 1; // Reset to first page when filtering
    
    renderProductsPage(container);
    renderPagination(container.closest('.tab-pane'));
}

function renderProductsPage(container) {
    container.innerHTML = '';
    
    if (filteredProducts.length === 0) {
        container.innerHTML = `
            <div class="col-12 text-center">
                <div style="padding: 50px; color: #333;">
                    <i class="fas fa-search-minus" style="font-size: 3rem; color: #2095AE; margin-bottom: 20px;"></i>
                    <h4 style="color: #333; margin-bottom: 15px; font-family: 'Gilda Display', serif;">No Products Match Your Filters</h4>
                    <p style="color: #666;">Try adjusting your search or filter criteria.</p>
                </div>
            </div>
        `;
        return;
    }

    // Calculate pagination
    const startIndex = (currentPage - 1) * itemsPerPage;
    const endIndex = startIndex + itemsPerPage;
    const productsToShow = filteredProducts.slice(startIndex, endIndex);

    productsToShow.forEach((product, index) => {
        const col = document.createElement('div');
        col.className = 'col-lg-4 col-md-6 mb-4';
        col.style.animationDelay = `${index * 0.1}s`;
        
        const fallbackImage = 'https://placehold.co/400x200/2095AE/ffffff?text=No+Image';
        let productImage = product.imageUrl || fallbackImage;
        
        if (productImage.includes('.heic')) {
            productImage = fallbackImage;
        }
        
        const contentsList = product.contents ? 
            product.contents.split('•').map(item => item.trim()).filter(item => item.length > 0) : [];
        
        col.innerHTML = `
            <div class="product-card" data-product-id="${product.id}">
                <div class="product-image-container">
                    <img src="${productImage}" 
                         alt="${product.name}" 
                         onerror="this.src='${fallbackImage}';"
                         loading="lazy"
                         class="product-image">
                </div>
                
                <div class="product-content">
                    <h3 class="product-name">${product.name}</h3>
                    <div class="product-price">€${product.price}</div>
                    <p class="product-description">${product.description || ''}</p>
                    
                    ${contentsList.length > 0 ? `
                        <div class="contents-preview">
                            <div class="contents-title">Includes</div>
                            <div class="contents-list">
                                ${contentsList.slice(0, 4).map(item => `
                                    <span class="content-tag">${item}</span>
                                `).join('')}
                                ${contentsList.length > 4 ? `
                                    <button class="content-tag view-all-btn" onclick="showAllIngredients('${product.id}')">
                                        +${contentsList.length - 4} more
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                    ` : ''}
                    
                    <div class="product-actions">
                        <div class="quantity-controls">
                            <button class="qty-btn" onclick="updateQuantity('${product.id}', -1)">
                                <i class="fas fa-minus"></i>
                            </button>
                            <span class="quantity-display" id="qty-${product.id}">0</span>
                            <button class="qty-btn" onclick="updateQuantity('${product.id}', 1)">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        
                        <button class="add-to-cart-btn" onclick="addToCart('${product.id}')">
                            <i class="fas fa-shopping-cart"></i>
                            <span>Add</span>
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        container.appendChild(col);
    });
}

function renderPagination(tabPane) {
    const paginationContainer = tabPane.querySelector('.pagination-container');
    if (!paginationContainer) return;
    
    const totalPages = Math.ceil(filteredProducts.length / itemsPerPage);
    
    if (totalPages <= 1) {
        paginationContainer.innerHTML = '';
        return;
    }
    
    let paginationHTML = `
        <nav aria-label="Product pagination" class="mt-4">
            <ul class="pagination justify-content-center">
    `;
    
    // Previous button
    paginationHTML += `
        <li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
            <button class="page-link" onclick="changePage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>
                <i class="fas fa-chevron-left"></i>
            </button>
        </li>
    `;
    
    // Page numbers
    const maxVisiblePages = 5;
    let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
    let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
    
    // Adjust start page if we're near the end
    if (endPage - startPage < maxVisiblePages - 1) {
        startPage = Math.max(1, endPage - maxVisiblePages + 1);
    }
    
    // First page and ellipsis
    if (startPage > 1) {
        paginationHTML += `
            <li class="page-item">
                <button class="page-link" onclick="changePage(1)">1</button>
            </li>
        `;
        if (startPage > 2) {
            paginationHTML += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
        }
    }
    
    // Visible page numbers
    for (let i = startPage; i <= endPage; i++) {
        paginationHTML += `
            <li class="page-item ${i === currentPage ? 'active' : ''}">
                <button class="page-link" onclick="changePage(${i})">${i}</button>
            </li>
        `;
    }
    
    // Last page and ellipsis
    if (endPage < totalPages) {
        if (endPage < totalPages - 1) {
            paginationHTML += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
        }
        paginationHTML += `
            <li class="page-item">
                <button class="page-link" onclick="changePage(${totalPages})">${totalPages}</button>
            </li>
        `;
    }
    
    // Next button
    paginationHTML += `
        <li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
            <button class="page-link" onclick="changePage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>
                <i class="fas fa-chevron-right"></i>
            </button>
        </li>
    `;
    
    paginationHTML += `
            </ul>
        </nav>
        <div class="text-center mt-3">
            <small class="text-muted">
                Showing ${Math.min((currentPage - 1) * itemsPerPage + 1, filteredProducts.length)} - 
                ${Math.min(currentPage * itemsPerPage, filteredProducts.length)} of ${filteredProducts.length} products
            </small>
        </div>
    `;
    
    paginationContainer.innerHTML = paginationHTML;
}

function changePage(page) {
    const totalPages = Math.ceil(filteredProducts.length / itemsPerPage);
    
    if (page < 1 || page > totalPages) return;
    
    currentPage = page;
    
    const container = document.getElementById(`${currentCategory}Container`);
    renderProductsPage(container);
    renderPagination(container.closest('.tab-pane'));
    updateQuantitiesFromCart();
    
    // Scroll to top of products section
    const productsSection = document.querySelector('.categories');
    if (productsSection) {
        productsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
}

// Update applyFilters function to work with pagination
function applyFilters() {
    let products = [...allProducts[currentCategory]]; // Start with all products for the current category

    const { search, priceRange, sortOrder, subCategory } = getFilterValues();
    const container = document.getElementById(`${currentCategory}Container`);

    // 1. Filter by Search
    if (search) {
        products = products.filter(product =>
            product.name.toLowerCase().includes(search) ||
            (product.description && product.description.toLowerCase().includes(search)) ||
            (product.contents && product.contents.toLowerCase().includes(search))
        );
    }

    // 2. Filter by Price Range
    if (priceRange) {
        const [minPriceStr, maxPriceStr] = priceRange.split('-');
        const minPrice = parseFloat(minPriceStr);
        const maxPrice = maxPriceStr ? parseFloat(maxPriceStr) : Infinity;

        products = products.filter(product => {
            const price = parseFloat(product.price);
            return price >= minPrice && price <= maxPrice;
        });
    }

    // 3. Filter by Sub-Category
    if (subCategory) {
        products = products.filter(product =>
            product.subCategory && product.subCategory.toLowerCase() === subCategory.toLowerCase()
        );
    }

    // 4. Sort Products
    if (sortOrder) {
        products.sort((a, b) => {
            if (sortOrder === 'price-asc') {
                return parseFloat(a.price) - parseFloat(b.price);
            } else if (sortOrder === 'price-desc') {
                return parseFloat(b.price) - parseFloat(a.price);
            } else if (sortOrder === 'name-asc') {
                return a.name.localeCompare(b.name);
            } else if (sortOrder === 'name-desc') {
                return b.name.localeCompare(a.name);
            }
            return 0;
        });
    }

    renderProducts(products, container);
    updateQuantitiesFromCart(); // Ensure quantities from cart are reflected on filtered products
}
    </script>
</body>
</html>